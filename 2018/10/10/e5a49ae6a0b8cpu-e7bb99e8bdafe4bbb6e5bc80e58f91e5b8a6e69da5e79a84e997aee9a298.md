---
title: '多核CPU 给软件开发带来的问题'
date: '2018-10-10T15:51:02+00:00'
status: publish
permalink: /2018/10/10/%e5%a4%9a%e6%a0%b8cpu-%e7%bb%99%e8%bd%af%e4%bb%b6%e5%bc%80%e5%8f%91%e5%b8%a6%e6%9d%a5%e7%9a%84%e9%97%ae%e9%a2%98
author: 毛巳煜
excerpt: ''
type: post
id: 3199
category:
    - 自学整理
tag: []
post_format: []
hestia_layout_select:
    - sidebar-right
wb_sst_seo:
    - 'a:3:{i:0;s:0:"";i:1;s:0:"";i:2;s:0:"";}'
---
#### [原文转载1](http://www.cnblogs.com/dolphin0520/p/3910667.html "原文转载1")

#### [原文转载2](https://blog.csdn.net/whl_program/article/details/70217354 "原文转载2")

- - - - - -

- - - - - -

- - - - - -

#### [通俗讲解 线程 与 进程 转载](https://www.zhihu.com/question/25532384/answer/411179772 "通俗讲解 线程 与 进程 转载")

- 线程在进程下行进（单纯的车厢无法运行）
- 一个进程可以包含多个线程（一辆火车可以有多个车厢）
- 不同进程间数据很难共享（一辆火车上的乘客很难换到另外一辆火车，比如站点换乘）
- 同一进程下不同线程间数据很易共享（A车厢换到B车厢很容易）
- 进程要比线程消耗更多的计算机资源（采用多列火车相比多个车厢更耗资源）
- 进程间不会相互影响，一个线程挂掉将导致整个进程挂掉（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢）
- 进程可以拓展到多机，进程最多适合多核（不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上）
- 进程使用的内存地址可以上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存。（比如火车上的洗手间）－**`互斥锁`**
- 进程使用的内存地址可以限定使用量（比如火车上的餐厅，最多只允许多少人进入，如果满了需要在门口等，等有人出来了才能进去）－**`信号量`**

- - - - - -

- - - - - -

- - - - - -

### 一.操作系统中为什么会出现进程？

 说起进程的由来，我们需要从操作系统的发展历史谈起。

 计算机刚出现的时候，是为了解决数学计算的问题，因为很多大量的计算通过人力去完成是很耗时间和人力成本的。在最初的时候，计算机只能接受一些特定的指令，用户输入一个指令，计算机就做一个操作。当用户在思考或者输入数据时，计算机就在等待。显然这样效率和很低下，因为很多时候，计算机处于等待用户输入的状态。

 那么能不能把一系列需要操作的指令预先写下来，形成一个清单，然后一次性交给计算机，计算机不断地去读取指令来进行相应的操作？就这样，**`批处理操作系统`** 诞生了。用户可以将需要执行的多个程序写在磁带上，然后交由计算机去读取并逐个地执行这些程序，并将输出结果写到另一个磁带上。

 虽然批处理操作系统的诞生极大地提高了任务处理的便捷性，但是仍然存在一个很大的问题：  
 假如有两个任务A和B，任务A在执行到一半的过程中，需要读取大量的数据输入（I/O操作），而此时CPU只能静静地等待任务A读取完数据才能继续执行，这样就白白浪费了CPU资源。人们于是想，**`能否在任务A读取数据的过程中，让任务B去执行，当任务A读取完数据之后，让任务B暂停，然后让任务A继续执行？`**

 但是这样就有一个问题：  
 原来每次都是一个程序在计算机里面运行，也就说内存中始终只有一个程序的运行数据。而如果想要任务A执行I/O操作的时候，让任务B去执行，必然内存中要装入多个程序，那么如何处理呢？多个程序使用的数据如何进行辨别呢？并且当一个程序运行暂停后，后面如何恢复到它之前执行的状态呢？

 这个时候人们就发明了进程，用进程来对应一个程序，每个进程对应一定的内存地址空间，并且只能使用它自己的内存空间，各个进程间互不干扰。并且进程保存了程序每个时刻的运行状态，这样就为进程切换提供了可能。当进程暂时时，它会保存当前进程的状态（比如进程标识、进程的使用的资源等），在下一次重新切换回来时，便根据之前保存的状态进行恢复，然后继续执行。

 **`这就是并发，能够让操作系统从宏观上看起来同一个时间段有多个任务在执行。换句话说，进程让操作系统的并发成为了可能。`**

### 二.为什么会出现线程？

 在出现了进程之后，操作系统的性能得到了大大的提升。虽然进程的出现解决了操作系统的并发问题，但是人们仍然不满足，人们逐渐对实时性有了要求。因为一个进程在一个时间段内只能做一件事情，如果一个进程有多个子任务，只能逐个地去执行这些子任务。比如对于一个监控系统来说，它不仅要把图像数据显示在画面上，还要与服务端进行通信获取图像数据，还要处理人们的交互操作。如果某一个时刻该系统正在与服务器通信获取图像数据，而用户又在监控系统上点击了某个按钮，那么该系统就要等待获取完图像数据之后才能处理用户的操作，如果获取图像数据需要耗费10s，那么用户就只有一直在等待。显然，对于这样的系统，人们是无法满足的。

 那么可不可以将这些子任务分开执行呢？即在系统获取图像数据的同时，如果用户点击了某个按钮，则会暂停获取图像数据，而先去响应用户的操作（因为用户的操作往往执行时间很短），在处理完用户操作之后，再继续获取图像数据。人们就发明了**`线程`** ，**`让一个线程去执行一个子任务，这样一个进程就包括了多个线程`** ，每个线程负责一个独立的子任务，这样在用户点击按钮的时候，就可以暂停获取图像数据的线程，让UI线程响应用户的操作，响应完之后再切换回来，让获取图像的线程得到CPU资源。从而让用户感觉系统是同时在做多件事情的，满足了用户对实时性的要求。

 换句话说，**`进程让操作系统的并发性成为可能`**，**`而线程让进程的内部并发成为可能`**。

 但是要注意，一个进程虽然包括多个线程，但是这些线程是共同享有进程占有的资源和地址空间的。**`进程是操作系统进行资源分配的基本单位`**，**`而线程是操作系统进行调度的基本单位`**。

### 三.多进程和多线程

 有人提出为什么监控系统要用一个进程实现（多线程）而不是多进程实现呢？  
答：多进程也可以实现，但是进程通信没有线程通信简单，想让里面的多线程共享资源（图像数据），所以整成了一个进程。

 进程可靠性高但是开销大，线程开销小但是可靠性低。根据不同情况选择不同模型。在需要并发处理并且需要共享一些变量的情况下，选择多线程。其他情况下，进程健壮性更好。

- - - - - -

#### **`要想学好技术就要先弄清楚它的由来，弄懂它的存在价值，肯定是为了解决某些问题而产生的方案！`**

- - - - - -

### 单核CPU 与 多核CPU的区别

**`单核CPU工作原理`** ： `假如线程池中有8条任务要处理`，它是从线程池的队列中一条一条的获取，是同步的 是阻塞的。

**`多核CPU工作原理`** ： `假如CPU为4核，线程池中有8条任务要处理`，它是从线程池的队列中一次就获取了4条任务， 两次就处理完所有的任务，速度非常快，但同时也有一个问题:

 如果任务的本身是要按照顺序同步处理的，因此 多核处理器 破坏了这个顺序，导致得到的结果是错误的。例如：

 我想要分为8次 依次输出 1 2 3 4 5 6 7 8 八个数字， 但因为多核处理的速度不一致，输出的结果很有可能就是乱序

- - - - - -

### 总结

 无论是哪种编程语言最终都是针对操作系统硬件(CPU)的应用，而每一种的编程语言用来**调用`多核CPU`或`多线程`的优化方案** 也不同。