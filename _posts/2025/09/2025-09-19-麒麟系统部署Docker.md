---
title: "éº’éºŸç³»ç»Ÿéƒ¨ç½²Docker"
date: "2025-09-19"
categories: 
  - "Docker"
---

# **éº’éºŸç³»ç»Ÿéƒ¨ç½²Docker**



## **1. æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬**

```bash
[root@localhost yum.repos.d]# nkvers
############## Kylin Linux Version #################
Release:
Kylin Linux Advanced Server release V10 (Halberd)

Kernel:
4.19.90-89.11.v2401.ky10.x86_64

Build:
Kylin Linux Advanced Server
release V10 SP3 2403/(Halberd)-x86_64-Build20/20240426
#################################################
```



## **2. å®‰è£… Docker**

### 2.1 å¸è½½ç³»ç»Ÿè‡ªå¸¦ Docker ç»„ä»¶

```bash
sudo dnf remove -y docker docker-client docker-client-latest docker-common \
  docker-latest docker-latest-logrotate docker-logrotate docker-runc
sudo rm -rf /var/lib/docker
```



### 2.2 å‡çº§ç³»ç»Ÿ OpenSSLï¼ˆé¿å…ä»“åº“ SSL é—®é¢˜ï¼‰

```bash
sudo dnf update -y openssl
```



### 2.3 å®‰è£…ä¾èµ–

```bash
sudo dnf install -y lvm2 --allowerasing
```

> æ³¨ï¼šKylin 10 è‡ªå¸¦ `dnf-plugins-core`ï¼Œæ— éœ€å†å®‰è£… `yum-utils`ï¼Œå¦åˆ™ä¼šå†²çªã€‚



### 2.4 é…ç½® Docker CE å®˜æ–¹ä»“åº“

```bash
sudo tee /etc/yum.repos.d/docker-ce.repo <<'EOF'
[docker-ce-stable]
name=Docker CE Stable - $basearch
baseurl=https://download.docker.com/linux/centos/8/$basearch/stable
enabled=1
gpgcheck=1
gpgkey=https://download.docker.com/linux/centos/gpg
EOF
```

åˆ·æ–°ç¼“å­˜ï¼š

```bash
sudo dnf clean all
sudo dnf makecache
sudo dnf list docker-ce --showduplicates
```



### 2.5 å®‰è£… Docker CE

```bash
sudo dnf install -y docker-ce docker-ce-cli containerd.io \
  docker-buildx-plugin docker-compose-plugin --nobest --allowerasing
```



### 2.6 å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯

```bash
sudo systemctl enable --now docker
```

éªŒè¯ï¼š

```bash
docker -v
# è¾“å‡ºç¤ºä¾‹ï¼š
# Docker version 26.1.3, build b72abbb
```





# éº’éºŸç³»ç»Ÿ-å®‰è£…DIFY



#### DIFY`.env`æ–‡ä»¶åªéœ€è¦ä¿®æ”¹ä¸¤å¤„

``` bash
# The type of vector store to use.
# Supported values are `weaviate`, `qdrant`, `milvus`, `myscale`, `relyt`, `pgvector`, `pgvecto-rs`, `chroma`, `opensearch`, `oracle`, `tencent`, `elast
icsearch`, `elasticsearch-ja`, `analyticdb`, `couchbase`, `vikingdb`, `oceanbase`, `opengauss`, `tablestore`,`vastbase`,`tidb`,`tidb_on_qdrant`,`baidu`,
`lindorm`,`huawei_cloud`,`upstash`, `matrixone`, `clickzetta`.
#VECTOR_STORE=weaviate
VECTOR_STORE=milvus


# æœ¬åœ°å¼€å‘æ—¶ä¸Šä¼ æ’ä»¶æ˜¯å¦å¼€å¯æ ¡éªŒ
#FORCE_VERIFYING_SIGNATURE=true
FORCE_VERIFYING_SIGNATURE=false
```



#### é…ç½®docker  2025å¹´å›½å†…æºï¼Œå‡†å¤‡ä¸‹è½½é•œåƒ

``` bash
vim /etc/docker/daemon.json

{
"registry-mirrors": ["https://docker.registry.cyou",
"https://docker-cf.registry.cyou",
"https://dockercf.jsdelivr.fyi",
"https://docker.jsdelivr.fyi",
"https://dockertest.jsdelivr.fyi",
"https://mirror.aliyuncs.com",
"https://dockerproxy.com",
"https://mirror.baidubce.com",
"https://docker.m.daocloud.io",
"https://docker.nju.edu.cn",
"https://docker.mirrors.sjtug.sjtu.edu.cn",
"https://docker.mirrors.ustc.edu.cn",
"https://mirror.iscas.ac.cn",
"https://docker.rainbond.cc"]
}

```

```
systemctl daemon-reload && systemctl restart docker
```



---



# å®‰è£…RAGFlow

è§£å†³`RAGFlow`ä¸`Dify`å®¹å™¨ç®¡ç†æ··ä¹±çš„é—®é¢˜

```bash
[root@localhost docker-ragflow]# tree /deploy/ -L 2
/deploy/
â”œâ”€â”€ dify-1.8.1
â”‚Â Â  â”œâ”€â”€ api
â”‚Â Â  â”œâ”€â”€ ......           çœç•¥å…¶å®ƒ
â”‚Â Â  â”œâ”€â”€ docker-dify      # å®ƒåŸæ¥æ˜¯ docker ï¼ŒæŠŠå®ƒæ”¹æˆ docker-dify å®¹å™¨ç®¡ç†å°±ä¸ä¼šæ··ä¹±äº†
â”‚Â Â  â”œâ”€â”€ images
â”‚Â Â  â”œâ”€â”€ Makefile
â”‚Â Â  â”œâ”€â”€ ......           çœç•¥å…¶å®ƒ
â”‚Â Â  â”œâ”€â”€ README.md
â”‚Â Â  â”œâ”€â”€ sdks
â”‚Â Â  â””â”€â”€ web
â”œâ”€â”€ dify-1.8.1.zip
â”œâ”€â”€ ragflow-0.20.5
â”‚Â Â  â”œâ”€â”€ agent
â”‚Â Â  â”œâ”€â”€ api
â”‚Â Â  â”œâ”€â”€ conf
â”‚Â Â  â”œâ”€â”€ Dockerfile
â”‚Â Â  â”œâ”€â”€ ......           çœç•¥å…¶å®ƒ
â”‚Â Â  â”œâ”€â”€ docker-ragflow   # å®ƒåŸæ¥æ˜¯ docker ï¼ŒæŠŠå®ƒæ”¹æˆ docker-ragflow å®¹å™¨ç®¡ç†å°±ä¸ä¼šæ··ä¹±äº†
â”‚Â Â  â”œâ”€â”€ example
â”‚Â Â  â”œâ”€â”€ helm
â”‚Â Â  â”œâ”€â”€ mcp
â”‚Â Â  â”œâ”€â”€ rag
â”‚Â Â  â”œâ”€â”€ README.md
â”‚Â Â  â”œâ”€â”€ sandbox
â”‚Â Â  â”œâ”€â”€ sdk
â”‚Â Â  â”œâ”€â”€ uv.lock
â”‚Â Â  â”œâ”€â”€ ......           çœç•¥å…¶å®ƒ
â”‚Â Â  â””â”€â”€ web
â””â”€â”€ ragflow-0.20.5.zip
```



#### CPU does not support

``` bash
[root@localhost docker-ragflow]# docker-compose logs -f minio mysql

ragflow-mysql  | Fatal glibc error: CPU does not support x86-64-v2
ragflow-mysql  | Fatal glibc error: CPU does not support x86-64-v2
ragflow-mysql  | Fatal glibc error: CPU does not support x86-64-v2
ragflow-mysql  | Fatal glibc error: CPU does not support x86-64-v2

ragflow-minio  | Fatal glibc error: CPU does not support x86-64-v2
ragflow-minio  | Fatal glibc error: CPU does not support x86-64-v2
ragflow-minio  | Fatal glibc error: CPU does not support x86-64-v2
ragflow-minio  | Fatal glibc error: CPU does not support x86-64-v2
```

#### GPTåˆ†æç»“æœ

ä½ é‡åˆ°çš„æŠ¥é”™ï¼š

```
Fatal glibc error: CPU does not support x86-64-v2
```

è¯´æ˜ä½ æ‹‰ä¸‹æ¥çš„ **MinIO** å’Œ **MySQL** é•œåƒé‡Œç¼–è¯‘çš„ glibc/libc åº“ï¼Œè¦æ±‚ CPU è‡³å°‘æ”¯æŒ `x86-64-v2` æŒ‡ä»¤é›†æ‰©å±•ï¼Œè€Œä½ çš„ç¯å¢ƒï¼ˆKylin V10 + è¾ƒè€ CPUï¼‰åªæ”¯æŒ `x86-64-v1`ã€‚



#### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

- 2023 å¹´åï¼Œå¾ˆå¤šå®˜æ–¹é•œåƒï¼ˆMySQL 8.0ã€MinIOã€ç”šè‡³ Python ç­‰ï¼‰éƒ½å¼€å§‹åŸºäº **Debian Bookworm / Ubuntu 22.04** æ„å»ºï¼Œè€Œè¿™äº›åº•å±‚ glibc ç‰ˆæœ¬é»˜è®¤è¦æ±‚ `x86-64-v2`ã€‚
- ä½ çš„ CPU æ¯”è¾ƒè€ï¼Œä¸æ”¯æŒ AVX/æŸäº› SSE æŒ‡ä»¤ï¼Œæ‰€ä»¥ä¸€è¿è¡Œå°±ç›´æ¥å´©æºƒã€‚



#### è§£å†³åŠæ³•

#### 1. **æ¢é•œåƒç‰ˆæœ¬ï¼ˆæ¨èï¼‰**

- é€‰ç”¨è¾ƒæ—§çš„é•œåƒï¼ˆglibc ä»ç„¶åŸºäº `x86-64-v1` æ„å»ºï¼‰ï¼Œä¾‹å¦‚ï¼š

  - MySQL:

    ```yaml
    image: mysql:5.7
    ```

    æˆ–è€… `mysql:8.0.28` ä¹‹å‰çš„ç‰ˆæœ¬ã€‚

  - MinIO:

    ```yaml
    image: minio/minio:RELEASE.2023-02-09T05-16-53Z
    ```

    ï¼ˆ2023 å¹´ 5 æœˆä¹‹å‰çš„ tag ä¸€èˆ¬è¿˜å…¼å®¹ `x86-64-v1`ï¼‰ã€‚

ä½ å¯ä»¥å» [Docker Hub](https://hub.docker.com/_/mysql) å’Œ [MinIO releases](https://github.com/minio/minio/releases) æ‰¾åˆ°è€çš„ tagã€‚



#### 2. **è‡ªå·±æ„å»ºå…¼å®¹é•œåƒ**

å¦‚æœå¿…é¡»ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥åŸºäºè¾ƒè€çš„åŸºç¡€é•œåƒï¼ˆå¦‚ `debian:bullseye` æˆ– `centos:7`ï¼‰é‡æ–°æ„å»ºï¼š

```dockerfile
FROM debian:bullseye-slim
# è£… MinIO æˆ– MySQL äºŒè¿›åˆ¶ï¼ˆå…¼å®¹ glibc v1ï¼‰
```

è¿™æ ·èƒ½ä¿è¯åœ¨ä½ è¿™ç±» CPU ä¸Šè¿è¡Œã€‚



#### 3. **æ¢ç¡¬ä»¶ / è™šæ‹ŸåŒ–å±‚**

å¦‚æœæœªæ¥ä½ éœ€è¦æ–°ç‰ˆæœ¬ MySQL/MinIOï¼Œè¿˜æ˜¯éœ€è¦ä¸€é¢—æ”¯æŒ `x86-64-v2` çš„ CPUï¼ˆå¤§æ¦‚ 2010 å¹´ä¹‹åçš„ Intel/AMD éƒ½æ”¯æŒï¼‰ã€‚
 æˆ–è€…ä½ ç”¨ **KVM/VMWare/QEMU**ï¼Œåœ¨è™šæ‹Ÿæœºé‡Œæ¨¡æ‹Ÿæ”¯æŒ `x86-64-v2` çš„ CPU ä¹Ÿèƒ½è·‘ã€‚



ğŸ‘‰ æ€»ç»“ï¼š
 åœ¨ä½ çš„ Kylin V10 æœºå™¨ä¸Šï¼Œ**ç›´æ¥æ¢é•œåƒç‰ˆæœ¬** æ˜¯æœ€çœäº‹çš„è§£å†³åŠæ³•ã€‚ä½ å¯ä»¥å…ˆå°è¯•æŠŠ `mysql` æ¢æˆ `5.7` æˆ– `8.0.28`ï¼ŒæŠŠ `minio` æ¢æˆ `2023å¹´2æœˆ`å·¦å³çš„ releaseã€‚

è¦ä¸è¦æˆ‘å¸®ä½ ç›´æ¥æŒ‘ä¸€ä¸ªâ€œæœ€ç¨³å®šçš„ MySQL + MinIO ç‰ˆæœ¬ç»„åˆâ€ï¼Œç»™ä½ å¯¹åº”çš„ `docker-compose.yml`ï¼Ÿ





## ä¿®æ”¹`docker-compose-base.yml`

``` yaml
# ....................
  mysql:
    # mysql:5.7 linux/arm64 image is unavailable.
    #image: mysql:8.0.39
    image: mysql:5.7                                                               # æ”¹ä¸º5.7
    container_name: ragflow-mysql
    env_file: .env
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_PASSWORD}
      - TZ=${TIMEZONE}
    command:
      --max_connections=1000
      --character-set-server=utf8mb4
      --collation-server=utf8mb4_unicode_ci
      #--default-authentication-plugin=mysql_native_password                       # 5.7 é»˜è®¤å°±æ˜¯ mysql_native_passwordï¼Œä¸éœ€è¦æ˜¾å¼æŒ‡å®š
      #--tls_version="TLSv1.2,TLSv1.3"
      --tls_version=TLSv1.2                                                        # å»æ‰ TLSv1.3
      --init-file /data/application/init.sql
      #--binlog_expire_logs_seconds=604800
      --expire_logs_days=7                                                         # æ›¿æ¢ binlog å‚æ•°ï¼ˆ7 å¤©å’Œ 604800 ç§’å·®ä¸å¤šï¼‰
    ports:
      - ${MYSQL_PORT}:3306
    volumes:
      - mysql_data:/var/lib/mysql
      - ./init.sql:/data/application/init.sql
    networks:
      - ragflow
    healthcheck:
      test: ["CMD", "mysqladmin" ,"ping", "-uroot", "-p${MYSQL_PASSWORD}"]
      interval: 10s
      timeout: 10s
      retries: 3
    restart: on-failure

  minio:
    #image: quay.io/minio/minio:RELEASE.2025-06-13T11-33-47Z
    image: quay.io/minio/minio:RELEASE.2023-02-09T05-16-53Z                       # æ”¹ä¸º2023å¹´5æœˆä¹‹å‰çš„ç‰ˆæœ¬
    container_name: ragflow-minio
    command: server --console-address ":9001" /data
    ports:
      - ${MINIO_PORT}:9000
      - ${MINIO_CONSOLE_PORT}:9001
    env_file: .env
    environment:
      - MINIO_ROOT_USER=${MINIO_USER}
      - MINIO_ROOT_PASSWORD=${MINIO_PASSWORD}
      - TZ=${TIMEZONE}
    volumes:
      - minio_data:/data
    networks:
      - ragflow
    restart: on-failure
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 30s
      timeout: 20s
      retries: 3
# ....................
```

