---
title: "SeekDB 多语言全文索引调研记录"
date: "2025-12-17"
categories: 
  - "databases"
---



# SeekDB 多语言全文索引调研记录

## 1. 测试目标

验证：
**同一字段上创建多个 FULLTEXT 索引（不同分词器）时，查询是否会按语言选择索引**

------

## 2. 表结构

```sql
CREATE TABLE t2 (
    id INT PRIMARY KEY,
    lang VARCHAR(4),
    doc VARCHAR(200),
    fulltext_doc TEXT,

    FULLTEXT INDEX idx_ft_zh (fulltext_doc)
        WITH PARSER ik
        PARSER_PROPERTIES = (ik_mode = "smart"),

    FULLTEXT INDEX idx_ft_ja (fulltext_doc)
        WITH PARSER ngram
        PARSER_PROPERTIES = (ngram_token_size = 2),

    FULLTEXT INDEX idx_ft_en (fulltext_doc)
        WITH PARSER beng
);
```

------

## 3. 索引状态确认

```sql
SHOW INDEX FROM t2;
```

结果（关键字段）：

```
idx_ft_zh   FULLTEXT  available
idx_ft_ja   FULLTEXT  available
idx_ft_en   FULLTEXT  available
```

------

## 4. 测试数据（节选）

```text
(301, 'mix', 'Apple iPhone 15',
 'Apple iPhone 15 是苹果最新发布的スマートフォン，在中国和日本市场非常受欢迎，是一款高端 fruit phone。')

(306, 'mix', 'Apple Watch',
 'Apple Watch は健康管理に役立つ smartwatch，支持 heart rate monitoring。')

(309, 'mix', '咖啡 Coffee コーヒー',
 '咖啡 Coffee コーヒー 是全球流行的饮品。')
```

------

## 5. 查询与结果

### 5.1 英文查询

```sql
SELECT id, doc
FROM t2
WHERE MATCH(fulltext_doc) AGAINST ('smartwatch');
```

结果：

```
(306, 'Apple Watch')
```

执行计划：

```
TEXT RETRIEVAL SCAN | t2(idx_ft_zh)
```

------

### 5.2 日文查询

```sql
SELECT id, doc
FROM t2
WHERE MATCH(fulltext_doc) AGAINST ('スマートフォン');
```

结果：

```
(301, 'Apple iPhone 15')
(309, '咖啡 Coffee コーヒー')
(302, 'Sony WH-1000XM5')
```

执行计划：

```
TEXT RETRIEVAL SCAN | t2(idx_ft_zh)
```

------

### 5.3 日文查询（二）

```sql
SELECT id, doc
FROM t2
WHERE MATCH(fulltext_doc) AGAINST ('コーヒー');
```

结果：

```
(309, '咖啡 Coffee コーヒー')
(301, 'Apple iPhone 15')
```

执行计划：

```
TEXT RETRIEVAL SCAN | t2(idx_ft_zh)
```

------

### 5.4 英文查询（二）

```sql
SELECT id, doc
FROM t2
WHERE MATCH(fulltext_doc) AGAINST ('fruit');
```

结果：

```
(301, 'Apple iPhone 15')
```

执行计划：

```
TEXT RETRIEVAL SCAN | t2(idx_ft_zh)
```

------

## 6. FORCE INDEX 验证

```sql
SELECT id, doc
FROM t2 FORCE INDEX (idx_ft_ja)
WHERE MATCH(fulltext_doc) AGAINST ('コーヒー');
```

执行计划：

```
TEXT RETRIEVAL SCAN | t2(idx_ft_zh)
```

结果：与未使用 FORCE INDEX 完全一致。

------

## 7. 语言条件验证

```sql
SELECT id, doc
FROM t2
WHERE lang = 'ja'
  AND MATCH(fulltext_doc) AGAINST ('コーヒー');
```

结果：
与不加 `lang` 条件一致。

执行计划：

```
TEXT RETRIEVAL SCAN | t2(idx_ft_zh)
```

------

## 8. 对比实验

| 场景                | 查询结果 | 执行计划  |
| ------------------- | -------- | --------- |
| 仅 idx_ft_zh        | 正常返回 | idx_ft_zh |
| zh + ja + en 三索引 | 完全一致 | idx_ft_zh |
| FORCE INDEX         | 无变化   | idx_ft_zh |
| lang 过滤           | 无变化   | idx_ft_zh |

------

## 9. 结论

> 在同一字段上创建多个 FULLTEXT 索引（不同分词器）时，
> **SeekDB 实际查询只会使用其中一个全文索引，且无法通过查询条件或 FORCE INDEX 改变。**

------

